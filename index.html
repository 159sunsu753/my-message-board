<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>私密留言板 - 用户登录</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h1>🔐 私密留言板</h1>
            <p class="subtitle">请输入您的访问密钥</p>
            
            <div class="input-group">
                <input type="text" id="secret-key" placeholder="输入您的专属密钥..." autocomplete="off">
                <button id="login-btn" class="login-button">进入对话</button>
            </div>
            
            <div class="admin-link">
                <a href="admin.html">管理员入口</a>
            </div>
            
            <div class="features">
                <h3>功能特点：</h3>
                <ul>
                    <li>🔒 端到端加密对话</li>
                    <li>💬 支持完整格式文本</li>
                    <li>🔄 实时消息同步</li>
                    <li>📱 多设备访问</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.getElementById('login-btn').addEventListener('click', userLogin);
        document.getElementById('secret-key').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') userLogin();
        });

        async function userLogin() {
            const secretKey = document.getElementById('secret-key').value.trim();
            if (!secretKey) {
                showAlert('请输入访问密钥', 'error');
                return;
            }

            showAlert('验证密钥中...', 'info');
            
            try {
                // 查找包含该密钥的Issue
                const issue = await findIssueBySecretKey(secretKey);
                if (issue) {
                    // 跳转到对话界面，传递Issue信息
                    localStorage.setItem('currentChat', JSON.stringify({
                        issueNumber: issue.number,
                        secretKey: secretKey,
                        userType: 'user'
                    }));
                    window.location.href = 'chat.html';
                } else {
                    showAlert('密钥无效或不存在', 'error');
                }
            } catch (error) {
                console.error('登录错误:', error);
                showAlert('验证失败，请检查网络连接', 'error');
            }
        }
    </script>
</body>
</html>
