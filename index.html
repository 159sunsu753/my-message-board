<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§å¯†å¯¹è¯ç³»ç»Ÿ - ç”¨æˆ·ç™»å½•</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h1>ğŸ” ç§å¯†å¯¹è¯ç³»ç»Ÿ</h1>
            <p class="subtitle">è¯·è¾“å…¥æ‚¨çš„è®¿é—®å¯†é’¥</p>
            
            <div class="input-group">
                <input type="text" id="secret-key" placeholder="è¾“å…¥æ‚¨çš„ä¸“å±å¯†é’¥..." autocomplete="off">
                <button id="login-btn" class="login-button">è¿›å…¥å¯¹è¯</button>
            </div>
            
            <div class="admin-link">
                <a href="admin-login.html">ç®¡ç†å‘˜ç™»å½•</a>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        document.getElementById('login-btn').addEventListener('click', userLogin);
        document.getElementById('secret-key').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') userLogin();
        });

        async function userLogin() {
            const secretKey = document.getElementById('secret-key').value.trim();
            if (!secretKey) {
                showAlert('è¯·è¾“å…¥è®¿é—®å¯†é’¥', 'error');
                return;
            }

            showAlert('éªŒè¯å¯†é’¥ä¸­...', 'info');
            
            try {
                // æŸ¥æ‰¾åŒ…å«è¯¥å¯†é’¥çš„å¯¹è¯
                const chat = await findChatBySecretKey(secretKey);
                if (chat) {
                    // è·³è½¬åˆ°å¯¹è¯ç•Œé¢
                    sessionStorage.setItem('currentChat', JSON.stringify({
                        issueNumber: chat.issueNumber,
                        secretKey: secretKey,
                        userType: 'user',
                        chatTitle: chat.title
                    }));
                    window.location.href = 'chat.html';
                } else {
                    showAlert('å¯†é’¥æ— æ•ˆæˆ–ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                showAlert('éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            }
        }
    </script>
</body>
</html>
