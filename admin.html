<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>私密对话系统 - 管理终端</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-container">
        <!-- 侧边栏 -->
        <div class="admin-sidebar">
            <div class="admin-header">
                <h2>🛠️ 管理终端</h2>
                <div class="admin-info">
                    <span id="admin-name">管理员</span>
                    <button id="logout-admin" class="logout-btn">退出</button>
                </div>
            </div>
            
            <nav class="admin-nav">
                <button class="nav-btn active" data-page="keys">密钥管理</button>
                <button class="nav-btn" data-page="chats">对话监控</button>
                <button class="nav-btn" data-page="settings">系统设置</button>
            </nav>

            <!-- 密钥管理页面 -->
            <div id="keys-page" class="admin-page active">
                <div class="page-header">
                    <h3>🔑 密钥管理</h3>
                    <button id="create-key-btn" class="primary-btn">创建新密钥</button>
                </div>
                
                <div class="create-key-form" style="display: none;">
                    <input type="text" id="new-key-name" placeholder="密钥名称（如：学生A）">
                    <input type="text" id="new-key-value" placeholder="密钥内容（支持中文）">
                    <button id="confirm-create-btn" class="primary-btn">确认创建</button>
                </div>

                <div class="key-list-container">
                    <h4>现有密钥列表</h4>
                    <div id="key-list" class="key-list">
                        <div class="loading">加载中...</div>
                    </div>
                </div>
            </div>

            <!-- 对话监控页面 -->
            <div id="chats-page" class="admin-page">
                <div class="page-header">
                    <h3>💬 对话监控</h3>
                </div>
                <div id="chat-list" class="key-list">
                    <div class="loading">加载对话列表中...</div>
                </div>
            </div>

            <!-- 系统设置页面 -->
            <div id="settings-page" class="admin-page">
                <div class="page-header">
                    <h3>⚙️ 系统设置</h3>
                </div>
                
                <div class="settings-form">
                    <div class="setting-item">
                        <label>当前管理员账号</label>
                        <input type="text" id="current-username" readonly>
                    </div>
                    
                    <div class="setting-item">
                        <label>更改管理员密码</label>
                        <input type="password" id="new-password" placeholder="新密码">
                        <input type="password" id="confirm-password" placeholder="确认新密码">
                        <button id="change-password-btn" class="primary-btn">更改密码</button>
                    </div>
                    
                    <div class="setting-item">
                        <label>系统信息</label>
                        <div class="system-info">
                            <p>仓库: <span id="repo-info">加载中...</span></p>
                            <p>对话数量: <span id="chat-count">-</span></p>
                            <p>最后同步: <span id="last-sync">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="admin-main">
            <div id="welcome-panel" class="welcome-panel">
                <div class="welcome-message">
                    <h1>欢迎使用管理终端</h1>
                    <p>请在左侧选择功能开始管理</p>
                    <div class="quick-stats">
                        <div class="stat-card">
                            <h3 id="total-keys">-</h3>
                            <p>总密钥数</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="active-chats">-</h3>
                            <p>活跃对话</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="total-messages">-</h3>
                            <p>总消息数</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="chat-panel" class="chat-panel" style="display: none;">
                <!-- 完整的聊天界面 -->
                <div class="chat-panel-header">
                    <button id="back-to-admin" class="back-button">← 返回管理</button>
                    <h3 id="current-chat-title">对话标题</h3>
                </div>
                <div class="chat-panel-content">
                    <!-- 这里直接嵌入聊天界面，而不是使用iframe -->
                    <div class="chat-container-internal">
                        <div class="messages-container-internal">
                            <div class="messages-scroll-internal" id="admin-message-list">
                                <div class="loading-messages">加载对话中...</div>
                            </div>
                        </div>
                        
                        <div class="input-container-internal">
                            <div class="input-wrapper-internal">
                                <textarea 
                                    id="admin-message-input" 
                                    placeholder="输入回复消息... (Enter发送，Shift+Enter换行)"
                                    rows="2"
                                ></textarea>
                                <button id="admin-send-btn" class="send-button-internal">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建密钥确认模态框 -->
    <div id="create-key-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>创建新密钥</h3>
            <div class="key-preview">
                <p><strong>名称:</strong> <span id="preview-name"></span></p>
                <p><strong>密钥:</strong> <span id="preview-key"></span></p>
            </div>
            <p class="warning">⚠️ 请妥善保存密钥内容，创建后无法修改！</p>
            <div class="modal-actions">
                <button id="confirm-create-modal" class="primary-btn">确认创建</button>
                <button id="cancel-create" class="secondary-btn">取消</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="admin-manager.js"></script>
</body>
</html>
